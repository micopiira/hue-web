(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{135:function(e,t){},137:function(e,t){},159:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"api",function(){return se}),n.d(a,"loading",function(){return le}),n.d(a,"currentBridge",function(){return ue}),n.d(a,"groups",function(){return de}),n.d(a,"bridges",function(){return he}),n.d(a,"usernames",function(){return fe}),n.d(a,"lights",function(){return ge});var r=n(0),i=n.n(r),o=n(80),c=n.n(o),s=n(9),l=n(14),u=(n(94),n(83)),d=n(7),h=n(5),f=n(10),g=n(8),m=n(11),p=n(1),b=n.n(p),v=["none","colorloop"],E=function(e,t,n){var a=e[t];if(!(a>=0&&a<=255))return new Error("Invalid prop '".concat(t,"' supplied to '").concat(n,"'. Octet value should be 0 - 255, '").concat(a,"' given."))},y={manufacturername:b.a.string,modelid:b.a.string,name:b.a.string,id:b.a.string,productid:b.a.string,state:b.a.shape({alert:b.a.oneOf(["none","select","lselect"]),bri:b.a.number,colormode:b.a.oneOf(["hs","xy","ct"]),ct:b.a.number,effect:b.a.oneOf(v),hue:b.a.number,on:b.a.bool,reachable:b.a.bool,sat:b.a.number}),swconfigid:b.a.string,swversion:b.a.string,type:b.a.string,uniqueid:b.a.string},w=(b.a.shape({action:b.a.object,class:b.a.string,id:b.a.string,lights:b.a.arrayOf(y.id),name:b.a.string,recycle:b.a.bool,state:b.a.object,type:b.a.string}),b.a.shape({r:E,g:E,b:E}),b.a.shape({id:b.a.string,ipaddress:b.a.string}),n(31)),O=n.n(w),j=n(25),C=n(84),k="SET_LIGHT_STATE",N="FETCH_LIGHTS",S="FETCH_LIGHTS_SUCCESS",x="FETCH_BRIDGES",I="FETCH_BRIDGES_SUCCESS",L="FETCH_GROUPS_SUCCESS",M="LOGIN",T="REGISTER",W="LOGOUT",B=function(e,t){return{type:e,payload:t}},D=function(e,t){return B(M,{bridge:e,username:t})},U=function(){return function(e){return e({type:x}),O.a.nupnpSearch().then(function(t){e(function(e){return B(I,e)}(t))})}},F=function(e,t){return function(n,a){return n(function(e,t){return B(k,{id:e,state:t})}(e,t)),a().api.setLightState(e,t).then(function(){return n(_())})}},H=function(){return function(e,t){return t().api.groups().then(function(t){e(function(e){return B(L,e)}(t.filter(function(e){return"Room"===e.type})))})}},_=function(){return function(e,t){return e({type:N}),t().api.lights().then(function(t){var n,a,r=t.lights;e(function(e){return B(S,e)}((n=r,a="id",Object.assign.apply(Object,[{}].concat(Object(C.a)(n.map(function(e){return Object(j.a)({},e[a],e)})))))))})}},A=function(e){return function(t,n){return new Promise(function(a,r){var i=n().usernames[e.id];i?a(i):window.confirm("Press link button on bridge ".concat(e.ipaddress," and then click OK"))?n().api.createUser(e.ipaddress).then(function(n){t(function(e,t){return B(T,{bridgeId:e,username:t})}(e.id,n)),a(n)}).catch(r):r(new Error("User cancelled linking"))}).then(function(n){t(D(e,n))})}},G=n(13),R=function(e){return e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92},P=function(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055},J=function(e,t,n){return[e,t].map(function(a){return(a/(e+t+n)).toFixed(4)})},q=function(e){return isNaN(e)?0:e};function X(e,t){var n=1-e-t,a=((arguments.length>2&&void 0!==arguments[2]?arguments[2]:254)/254).toFixed(2),r=a/t*e,i=a/t*n,o=1.656492*r-.354851*a-.255038*i,c=.707196*-r+1.655397*a+.036152*i,s=.051713*r-.121364*a+1.01153*i;return o>s&&o>c&&o>1?(c/=o,s/=o,o=1):c>s&&c>o&&c>1?(o/=c,s/=c,c=1):s>o&&s>c&&s>1&&(o/=s,c/=s,s=1),[o,c,s].map(P).map(function(e){return Math.round(255*e)}).map(q)}var Y=function(e){function t(){var e;return Object(d.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).state={r:0,g:0,b:0,visible:!1},e.handleClick=e.handleClick.bind(Object(G.a)(e)),e.drawColorWheel=e.drawColorWheel.bind(Object(G.a)(e)),e}return Object(m.a)(t,e),Object(h.a)(t,null,[{key:"getDerivedStateFromProps",value:function(e,t){return e.color}}]),Object(h.a)(t,[{key:"handleClick",value:function(e){var t=this,n=this.ctx.getImageData(e.nativeEvent.offsetX,e.nativeEvent.offsetY,1,1).data;this.setState({r:n[0],g:n[1],b:n[2]},function(){var e,n,a;t.props.onChange({rgb:t.state,xy:(e=t.state.r,n=t.state.g,a=t.state.b,e=R(e),n=R(n),a=R(a),J(.664511*e+.154324*n+.162028*a,.283881*e+.668433*n+.047685*a,88e-6*e+.07231*n+.986039*a).map(q)).map(parseFloat)})})}},{key:"drawColorWheel",value:function(){var e=this.refs.canvas;this.ctx=e.getContext("2d");var t,n,a,r,i,o,c,s,l,u,d,h,f=e.width/2,g=e.height/2,m=e.height/2.3,p=this.ctx.createImageData(e.width,e.height),b=p.data,v=0;for(r=0;r<e.height;r+=1)for(a=0;a<e.width;a+=1,v+=4)(c=(i=a-f)*i+(o=r-g)*o)<m*m&&(t=6*(Math.atan2(o,i)+Math.PI)/(2*Math.PI),u=255*(1-(n=Math.sqrt(c)/m)),d=255*(1-n*(s=t-(l=Math.floor(t)))),h=255*(1-n*(1-s)),b[v]=[255,d,u,u,h,255,255][l],b[v+1]=[h,255,255,d,u,u,h][l],b[v+2]=[u,u,h,255,255,d,u][l],b[v+3]=255);this.ctx.putImageData(p,0,0)}},{key:"componentDidMount",value:function(){this.setState(this.props.color),this.drawColorWheel()}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{style:{position:"relative"}},i.a.createElement("div",{onMouseOver:function(){return e.setState({visible:!0})},onMouseOut:function(){return e.setState({visible:!1})},className:"custom-select",style:{height:50,width:"100%"}},i.a.createElement("div",{style:{backgroundColor:"rgb(".concat(this.state.r,",").concat(this.state.g,",").concat(this.state.b,")"),height:"100%"}})),i.a.createElement("div",{onMouseOver:function(){return e.setState({visible:!0})},onMouseOut:function(){return e.setState({visible:!1})},style:{visibility:this.state.visible?"visible":"hidden",position:"absolute",cursor:"pointer",zIndex:999,top:50,left:0}},i.a.createElement("div",{className:"popover bs-popover-bottom",style:{width:320,position:"relative",maxWidth:320}},i.a.createElement("div",{className:"arrow",style:{top:0,left:"15px"}}),i.a.createElement("div",{className:"popover-body"},i.a.createElement("canvas",{height:300,width:300,ref:"canvas",onClick:this.handleClick})))))}}]),t}(i.a.Component),z=n(59),K=n.n(z),$=function(e){function t(){var e;return Object(d.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).state={r:0,g:0,b:0},e.handleClick=e.handleClick.bind(Object(G.a)(e)),e.drawColorWheel=e.drawColorWheel.bind(Object(G.a)(e)),e}return Object(m.a)(t,e),Object(h.a)(t,[{key:"handleClick",value:function(e){var t=this,n=this.ctx.getImageData(e.nativeEvent.offsetX,e.nativeEvent.offsetY,1,1).data;this.setState({r:n[0],g:n[1],b:n[2]},function(){t.props.onChange({rgb:t.state,ct:Math.round(1e6/K.a.rgb2colorTemperature({red:t.state.r,green:t.state.g,blue:t.state.b}))})})}},{key:"drawColorWheel",value:function(){var e=this.refs.canvas;this.ctx=e.getContext("2d");for(var t=e.width,n=e.height,a=this.ctx.createImageData(e.width,e.height),r=a.data,i=0;i<t;i+=1)for(var o=0;o<n;o+=1){var c=4*(o*t+i),s=4500/t*i+2e3,l=K.a.colorTemperature2rgb(s),u=l.red,d=l.green,h=l.blue;r[c]=u,r[c+1]=d,r[c+2]=h,r[c+3]=255}this.ctx.putImageData(a,0,0)}},{key:"componentDidMount",value:function(){this.drawColorWheel()}},{key:"render",value:function(){return i.a.createElement("canvas",{style:{cursor:"pointer",border:"1px solid #ced4da"},className:"img-fluid",height:50,ref:"canvas",onClick:this.handleClick})}}]),t}(i.a.Component),Q=Object(s.b)(null,function(e,t){return Object(l.b)({setLightState:function(e){return F(t.light.id,e)}},e)})(function(e){var t=e.light,n=e.setLightState;return i.a.createElement("div",{className:"card"},i.a.createElement("div",{className:"card-body"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-sm-2"},i.a.createElement("button",{type:"button",disabled:!t.state.reachable,className:"btn btn-primary"+(t.state.on?" active":""),"aria-pressed":t.state.on,onClick:function(){return n({on:!t.state.on})}},i.a.createElement("i",{className:"fa fa-power-off","aria-hidden":"true"}))),i.a.createElement("div",{className:"col-sm-10"},i.a.createElement("h5",null,!t.state.reachable&&i.a.createElement("i",{className:"fa fa-exclamation-triangle text-warning","aria-hidden":"true",title:"Unreachable"}),"\xa0",t.name))),t.state.on&&i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"effect"},"Effect"),i.a.createElement("select",{id:"effect",className:"form-control",onChange:function(e){return n({effect:e.target.value})},value:t.state.effect},v.map(function(e){return i.a.createElement("option",{key:e,value:e},e)}))),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"color"},"Color"),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-sm"},i.a.createElement(Y,{onChange:function(e){var t=e.xy;return n({xy:t})},color:{r:X(t.state.xy[0],t.state.xy[1],t.state.bri)[0],g:X(t.state.xy[0],t.state.xy[1],t.state.bri)[1],b:X(t.state.xy[0],t.state.xy[1],t.state.bri)[2]}})),i.a.createElement("div",{className:"col-sm"},i.a.createElement($,{onChange:function(e){var t=e.ct;return n({ct:t})}})))),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"brightness",className:"col-form-label"},"Brightness"),i.a.createElement("input",{type:"range",style:{padding:0},className:"form-control",id:"brightness",value:t.state.bri,onChange:function(e){return n({bri:parseInt(e.target.value,10)})},min:0,max:254}))))))}),V=Object(s.b)(function(e){return{groups:e.groups,lights:e.lights}},function(e,t){return Object(l.b)({setLightState:function(e,t){return F(e,t)}},e)})(function(e){var t=e.groups,n=e.lights,a=e.currentLight,r=e.onChange,o=e.setLightState;return i.a.createElement("ul",{className:"list-group list-group-flush"},t.map(function(e){return i.a.createElement("li",{key:e.id,className:"list-group-item"},i.a.createElement("h5",null,e.name),i.a.createElement("div",{className:"list-group list-group-flush"},e.lights.map(function(e){var t=n[e].state.reachable,c=[["list-group-item list-group-item-action d-flex justify-content-between align-items-center",!0],["active",parseInt(a)===parseInt(e)],["disabled",!t]].map(function(e){return e[1]?e[0]:[]}).join(" ");return i.a.createElement("div",{className:c,onClick:function(){return t?r(e):{}},key:e,title:t?"":"Unreachable"},n[e].name,i.a.createElement("input",{type:"checkbox",disabled:!t,checked:n[e].state.on&&t,onChange:function(){return o(e,{on:!n[e].state.on})}}))})))}))}),Z=function(e){function t(){var e,n;Object(d.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={currentLight:""},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.username?(this.props.dispatch(D(this.props.currentBridge,this.props.username)),this.props.dispatch(_()).then(function(){return e.props.dispatch(H())})):this.props.dispatch(B(W))}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-3"},i.a.createElement(V,{currentLight:this.state.currentLight,onChange:function(t){e.setState({currentLight:t})}})),i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"container"},this.props.lights[this.state.currentLight]?i.a.createElement(Q,{light:this.props.lights[this.state.currentLight]}):"No light selected")))}}]),t}(i.a.Component),ee=Object(s.b)(function(e){var t=e.usernames,n=e.currentBridge,a=e.bridges;return{lights:e.lights,username:t[n],currentBridge:a.find(function(e){return e.id===n})}})(Z),te=(n(157),n(158),function(){return[i.a.createElement("i",{key:1,className:"fa fa-circle-o-notch fa-spin fa-fw text-info m-2"}),i.a.createElement("span",{key:2,className:"sr-only"},"Loading...")]}),ne=function(e){function t(){return Object(d.a)(this,t),Object(f.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(U())}},{key:"bridgesList",value:function(){var e=this;return i.a.createElement("div",{className:"container"},i.a.createElement("h1",{className:"lead"},"Select bridge:"),i.a.createElement("div",{className:"list-group"},this.props.bridges.map(function(t){return i.a.createElement("button",{className:"list-group-item list-group-item-action",key:t.id,onClick:function(){return e.props.dispatch(A(t))}},t.ipaddress)})))}},{key:"noBridges",value:function(){return this.props.loading?i.a.createElement("p",null,"Loading..."):i.a.createElement("strong",null,"No bridges found")}},{key:"render",value:function(){return this.props.bridges.length>0?this.bridgesList():this.noBridges()}}]),t}(r.Component),ae=Object(s.b)(function(e){return{bridges:e.bridges,loading:e.loading}})(ne),re=function(e){function t(){return Object(d.a)(this,t),Object(f.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return[i.a.createElement("nav",{key:0,className:"navbar navbar-light bg-light mb-3"},i.a.createElement("div",{className:"container"},i.a.createElement("a",{className:"navbar-brand",href:"/"},"Hue Web"))),i.a.createElement("div",{key:1},this.props.loading&&i.a.createElement("div",{className:"fixed-top text-right"},i.a.createElement(te,null)),this.props.currentBridge?i.a.createElement(ee,null):i.a.createElement(ae,null))]}}]),t}(r.Component),ie=Object(s.b)(function(e){var t=e.currentBridge,n=e.bridges;return{loading:e.loading,currentBridge:n.find(function(e){return e.id===t})}})(re),oe=function(e){function t(){var e,n;Object(d.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(r)))).state={hasError:!1},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentDidCatch",value:function(e,t){this.setState({hasError:!0})}},{key:"render",value:function(){var e=this;return this.state.hasError?i.a.createElement("div",{className:"alert alert-danger mt-4",role:"alert"},i.a.createElement("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",onClick:function(){return e.setState({hasError:!1})}},i.a.createElement("span",{"aria-hidden":"true"},"\xd7")),i.a.createElement("strong",null,"Oh snap!")," Something went wrong"):this.props.children}}]),t}(r.Component),ce=n(32),se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w.HueApi,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case M:var n=t.payload,a=n.bridge,r=n.username;return new w.HueApi(a.ipaddress,r);default:return e}},le=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!(arguments.length>1?arguments[1]:void 0).type.includes("_SUCCESS")},ue=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case M:return t.payload.bridge.id;case W:return null;default:return e}},de=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case L:return t.payload;default:return e}},he=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case I:return t.payload;default:return e}},fe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case T:return Object(ce.a)({},e,Object(j.a)({},t.payload.bridgeId,t.payload.username));default:return e}},ge=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S:return t.payload;case k:var n=t.payload;return Object(ce.a)({},e,Object(j.a)({},n.id,Object(ce.a)({},e[n.id],{state:Object(ce.a)({},e[n.id].state,n.state)})));default:return e}},me=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function pe(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var be=Object(l.e)(Object(l.c)(a),localStorage.getItem("reduxState")?JSON.parse(localStorage.getItem("reduxState")):{},Object(l.d)(Object(l.a)(u.a)));be.subscribe(function(){var e,t={usernames:(e=be.getState()).usernames,currentBridge:e.currentBridge};localStorage.setItem("reduxState",JSON.stringify(t))}),c.a.render(i.a.createElement(s.a,{store:be},i.a.createElement(oe,null,i.a.createElement(ie,null))),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/hue-web",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/hue-web","/service-worker.js");me?(function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):pe(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):pe(t,e)})}}()},85:function(e,t,n){e.exports=n(159)}},[[85,1,2]]]);
//# sourceMappingURL=main.dcf6f68c.chunk.js.map